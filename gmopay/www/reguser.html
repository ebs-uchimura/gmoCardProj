<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>新規ユーザ登録画面</title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
  <link rel="stylesheet" href="css/index.css">
</head>

<body>
  <h1>新規ユーザ登録</h1>
  <div class="wrapper">
    <div class="pubwrapper">
      <div class="customerno">顧客番号</div>
      <input type="text" id="customerno" class="customerno" name="customerno" value="">&nbsp;&emsp;&emsp;
    </div>
    <div class="pubwrapper">
      <div class="customername">店舗名</div>
      <input type="text" id="customername" class="customername" name="customername" value="">&nbsp;様
    </div>
    <div class="pubflex">
      <div class="pubwrapper">
        <button type="button" id="btnReg" class="button-g button-3 button-standard"
          onclick="registUser()">ユーザ登録</button>
      </div>
      <div class="pubwrapper">
        <button type="button" id="btnClear" class="button-g button-4 button-standard" onclick="clearAll()">
          クリア
        </button>
      </div>
    </div>
    <div class="pubwrapper">
      <button type="button" class="button-g button-6 button-standard" role="button" onclick="history.back()">トップへ戻る
    </div>
  </div>
  <footer>
    <p><small>&copy; 2024 Satsuma Ebisudo All Rights Reserved. </small></p>
  </footer>

  <script>
    // エラーフラグ
    let errorflg = false;
    // エラーメッセージ
    let errorArray = [];

    // 顧客番号
    const customernoDom = document.getElementById('customerno');
    // 顧客名
    const customernameDom = document.getElementById('customername');

    // 発行完了
    window.api.on('useredit_finish', arg => {
      // クリア
      customernoDom.value = '';
      customernameDom.value = '';
    });

    // ユーザ登録
    const registUser = () => {
      try {
        console.log("user regist mode");
        // 顧客番号
        const customerno = customernoDom.value;
        // 顧客名
        const customername = customernameDom.value;

        // エラー初期化
        errorflg = false

        /* バリデーション */
        // 顧客番号
        if (customerno == "") {
          errorArray.push("顧客番号が空欄です");
          errorflg = true;
        }
        // 顧客名
        if (customername == "") {
          errorArray.push("顧客名を選択してください");
          errorflg = true;
        }

        // エラーなし
        if (!errorflg) {
          // 送付内容
          const customerObj = {
            customerno: customerno, // 顧客番号
            customername: customername, // 顧客名
          }
          // 配信モード
          window.api.send("reguser", customerObj);

        } else {
          // メッセージオプション
          const messageOption = {
            title: "エラー",
            message: errorArray.join("|"),
            type: "error",
          }
          // エラー表示
          window.api.send("showmessage", messageOption);
        }

      } catch (e) {
        // エラー処理
        window.api.send("error", e);
      }
    }

    // クリア
    const clearAll = () => {
      try {
        console.log("clear mode");
        // フォーム初期化
        customernoDom.value = '';
        customernameDom.value = '';

      } catch (e) {
        // エラー処理
        window.api.send("error", e);
      }
    }
  </script>
</body>

</html>